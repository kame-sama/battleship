var ce=Object.defineProperty;var de=(s,e,t)=>e in s?ce(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var T=(s,e,t)=>(de(s,typeof e!="symbol"?e+"":e,t),t),j=(s,e,t)=>{if(!e.has(s))throw TypeError("Cannot "+t)};var c=(s,e,t)=>(j(s,e,"read from private field"),t?t.call(s):e.get(s)),l=(s,e,t)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,t)},u=(s,e,t,r)=>(j(s,e,"write to private field"),r?r.call(s,t):e.set(s,t),t);var J=(s,e,t,r)=>({set _(i){u(s,e,i,t)},get _(){return c(s,e,r)}}),L=(s,e,t)=>(j(s,e,"access private method"),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();var C,S;class le{constructor(e){l(this,C,void 0);l(this,S,void 0);u(this,C,e),u(this,S,0)}hit(){if(this.isSunk())throw new Error("Can't hit sunken ship");J(this,S)._++}isSunk(){return c(this,S)===c(this,C)}}C=new WeakMap,S=new WeakMap;const R=10,v={carrier:5,battleship:4,cruiser:3,submarine:3,destroyer:1};var k,A,g,O,X,re,Y,ie;const M=class M{constructor(){T(this,"board");l(this,k,void 0);l(this,A,void 0);l(this,g,void 0);l(this,O,void 0);var e,t;this.board=L(e=M,X,re).call(e),u(this,k,!1),u(this,A,L(t=M,Y,ie).call(t)),u(this,g,new Map),u(this,O,0)}isAllShipsPlaced(){return c(this,g).size===5}isAllShipsSunk(){return c(this,O)===5}isCollision(e,t,r){let[i,o]=t;for(let n=0;n<v[e];n++){if(this.board[i][o]!==""&&this.board[i][o]!==e)return!0;r==="up"?i--:r==="right"?o++:r==="down"?i++:o--}return!1}isOutOfBounds(e,t,r){let[i,o]=t;return r==="up"?i-=v[e]-1:r==="right"?o+=v[e]-1:r==="down"?i+=v[e]-1:o-=v[e]-1,i<0||i>=R||o<0||o>=R}placeShip(e,t,r){if(c(this,k))throw new Error("Can't move ships at this game stage");if(this.isOutOfBounds(e,t,r))throw new Error("Invalid placement: Got out of bound");if(this.isCollision(e,t,r))throw new Error("Invalid placement: Collision ocurred");if(c(this,g).has(e)){const a=c(this,g).get(e);for(const[E,ae]of a)this.board[E][ae]=""}const i=[];let[o,n]=t;for(let a=0;a<v[e];a++)r==="up"?(this.board[o][n]=e,i.push([o,n]),o--):r==="right"?(this.board[o][n]=e,i.push([o,n]),n++):r==="down"?(this.board[o][n]=e,i.push([o,n]),o++):(this.board[o][n]=e,i.push([o,n]),n--);return c(this,g).set(e,i),this}receiveAttack([e,t]){if(this.board[e][t]==="")return this.board[e][t]="miss","miss";const r=this.board[e][t];return c(this,A)[r].hit(),this.board[e][t]="hit",c(this,A)[r].isSunk()?(J(this,O)._++,"sunk"):"hit"}ready(){if(!this.isAllShipsPlaced())throw new Error("Should place all ships before game start");return u(this,k,!0),this}};k=new WeakMap,A=new WeakMap,g=new WeakMap,O=new WeakMap,X=new WeakSet,re=function(){return new Array(R).fill("").map(()=>new Array(R).fill(""))},Y=new WeakSet,ie=function(){const e={};for(const[t,r]of Object.entries(v))e[t]=new le(r);return e},l(M,X),l(M,Y);let N=M;class _{constructor(e){T(this,"name");T(this,"gameboard");T(this,"moves");this.name=e,this.gameboard=new N,this.moves=new Map}makeMove(e){const t=e.toString();if(this.moves.has(t))throw new Error("Can't play the same move twice");return e}storeMove(e,t){const r=e.toString();this.moves.set(r,t)}}const ee=10,te=["up","right","down","left"];var b,P,q,Q,x,U;const m=class m extends _{constructor(){var t,r,i,o;super("Bot");l(this,b,void 0);l(this,P,void 0);u(this,b,[]),u(this,P,["destroyer","submarine","cruiser","battleship","carrier"]);for(let n=0;n<this.gameboard.board.length;n++)for(let a=0;a<this.gameboard.board.length;a++)c(this,b).push([n,a]);for(;c(this,P).length;){const n=c(this,P).pop();let a=L(t=m,x,U).call(t),E=L(r=m,q,Q).call(r);for(;this.gameboard.isOutOfBounds(n,a,E)||this.gameboard.isCollision(n,a,E);)a=L(i=m,x,U).call(i),E=L(o=m,q,Q).call(o);this.gameboard.placeShip(n,a,E)}}getRandomValidMove(){const t=Math.floor(Math.random()*c(this,b).length),r=c(this,b)[t];return c(this,b).splice(t,1),r}};b=new WeakMap,P=new WeakMap,q=new WeakSet,Q=function(){const t=Math.floor(Math.random()*te.length);return te[t]},x=new WeakSet,U=function(){const t=Math.floor(Math.random()*ee),r=Math.floor(Math.random()*ee);return[t,r]},l(m,q),l(m,x);let B=m;function D(s){const e=s.target;if(e instanceof HTMLDivElement&&(e.classList.contains("carrier")||e.classList.contains("battleship")||e.classList.contains("cruiser")||e.classList.contains("submarine")||e.classList.contains("destroyer"))){const t=e.cloneNode(!0);t.style.position="absolute",t.style.zIndex="1000",t.style.transformOrigin="20px 20px",document.body.append(t),oe(s.pageX,s.pageY,t);const r=ue(t);document.addEventListener("keydown",r),document.addEventListener("mousemove",se),t.addEventListener("mouseup",i=>{document.removeEventListener("mousemove",se),document.removeEventListener("keydown",r),t.remove(),document.elementFromPoint(i.clientX,i.clientY).click()})}}function ue(s){let e="right";return function(t){t.key==="r"&&(e==="right"?(s.style.rotate="90deg",e="down"):e==="down"?(s.style.rotate="180deg",e="left"):e==="left"?(s.style.rotate="270deg",e="up"):(s.style.rotate="0deg",e="right"))}}function oe(s,e,t){t.style.left=`${s-20}px`,t.style.top=`${e-20}px`}function se(s){const e=s.target;e instanceof HTMLDivElement&&(e.classList.contains("carrier")||e.classList.contains("battleship")||e.classList.contains("cruiser")||e.classList.contains("submarine")||e.classList.contains("destroyer"))&&oe(s.pageX,s.pageY,e)}function ne(s){if(s.classList.contains("cell")&&s.dataset.coords){const e=s.dataset.coords;return[parseInt(e[0]),parseInt(e[1])]}throw new Error('Invalid input: expect HTMLDivElement of class "cell"')}function w(s,e,t){e.textContent="",s.forEach((r,i)=>{r.forEach((o,n)=>{const a=document.createElement("div");a.classList.add("cell"),a.setAttribute("data-coords",`${i}${n}`),o==="miss"?a.classList.add("miss"):o==="hit"&&a.classList.add("hit"),t==="player"&&o!==""&&o!=="miss"&&a.classList.add("ship"),e.appendChild(a)})})}const H=document.querySelector("#player"),z=document.querySelector("#enemy"),y=document.querySelector("#message"),F=document.querySelector(".carrier"),G=document.querySelector(".battleship"),V=document.querySelector(".cruiser"),W=document.querySelector(".submarine"),Z=document.querySelector(".destroyer"),K=document.querySelector("#start"),he=document.querySelector("#restart");let h=new _("Player");w(h.gameboard.board,H,"player");let p=new B;w(p.gameboard.board,z,"enemy");let d,f="right",$=!1,I=!1;F.addEventListener("mousedown",D);G.addEventListener("mousedown",D);V.addEventListener("mousedown",D);W.addEventListener("mousedown",D);Z.addEventListener("mousedown",D);F.addEventListener("mousedown",()=>{d="carrier"});G.addEventListener("mousedown",()=>{d="battleship"});V.addEventListener("mousedown",()=>{d="cruiser"});W.addEventListener("mousedown",()=>{d="submarine"});Z.addEventListener("mousedown",()=>{d="destroyer"});window.addEventListener("keydown",s=>{if(s.key==="r")switch(f){case"right":f="down";break;case"down":f="left";break;case"left":f="up";break;default:f="right";break}});document.body.addEventListener("click",()=>{d=void 0,f="right"});H.addEventListener("click",s=>{if(s.stopPropagation(),!I&&s.target instanceof HTMLDivElement&&d&&f){const e=ne(s.target);try{h.gameboard.placeShip(d,e,f),w(h.gameboard.board,H,"player"),d==="carrier"?F.classList.add("placed"):d==="battleship"?G.classList.add("placed"):d==="cruiser"?V.classList.add("placed"):d==="submarine"?W.classList.add("placed"):d==="destroyer"&&Z.classList.add("placed")}catch(t){t instanceof Error&&(y.innerHTML+=`${t.message}<br>`)}d=void 0,f="right"}});K.addEventListener("click",()=>{if(!I)try{h.gameboard.ready(),$=!0,y.innerHTML+="Game started<br>",K.toggleAttribute("disabled")}catch(s){s instanceof Error&&(y.innerHTML+=`${s.message}<br>`)}});z.addEventListener("click",s=>{if($&&s.target instanceof HTMLDivElement){const e=ne(s.target);try{h.makeMove(e)}catch(r){if(r instanceof Error){y.innerHTML+=`${r.message}<br>`;return}}const t=p.gameboard.receiveAttack(e);w(p.gameboard.board,z,"enemy"),y.innerHTML+=`${t}<br>`,h.storeMove(e,t),p.gameboard.isAllShipsSunk()&&(y.innerHTML+="Player WINs<br>",$=!1,I=!0),h.gameboard.receiveAttack(p.makeMove(p.getRandomValidMove())),w(h.gameboard.board,H,"player"),h.gameboard.isAllShipsSunk()&&(y.innerHTML+="Bot WINs<br>",$=!1,I=!0)}});he.addEventListener("click",()=>{I=!1,h=new _("Player"),w(h.gameboard.board,H,"player"),p=new B,w(p.gameboard.board,z,"enemy"),y.innerHTML="",K.disabled&&K.toggleAttribute("disabled"),F.classList.remove("placed"),G.classList.remove("placed"),V.classList.remove("placed"),W.classList.remove("placed"),Z.classList.remove("placed")});
